{
  "idea": "type-safe-refs",
  "status": "design_complete",
  "summary": "Replace loose string damage sources with type-safe enums and structured references",
  "trigger": "Combat UI needs displayable damage breakdowns; loose strings prevent this",
  "phases": {
    "brainstorm": {
      "status": "completed",
      "date": "2025-12-07",
      "file": "brainstorm.md",
      "notes": "Explored flat enum vs oneof approaches. React expert recommended oneof for TypeScript discriminated unions."
    },
    "use_cases": {
      "status": "completed",
      "date": "2025-12-07",
      "file": "use-cases.md",
      "notes": "UI damage breakdown display, enum display component pattern, React consumption"
    },
    "architecture": {
      "status": "skipped",
      "reason": "Extends existing DamageComponent pattern, no new architectural decisions needed"
    },
    "design": {
      "status": "completed",
      "date": "2025-12-07",
      "files": ["design-protos.md"],
      "notes": "SourceRef with oneof, ConditionId enum, no homebrew escape hatch"
    },
    "issues": {
      "status": "completed",
      "date": "2025-12-07",
      "links": [
        "https://github.com/KirkDiggler/rpg-api-protos/issues/83"
      ],
      "notes": "Design comment added to issue with full rationale"
    }
  },
  "decisions": [
    {
      "question": "Flat enum vs structured oneof?",
      "answer": "Structured oneof in SourceRef message",
      "reason": "Flat enum would duplicate existing enums (WEAPON_LONGSWORD becomes DAMAGE_SOURCE_LONGSWORD). oneof reuses Weapon, Ability enums directly and structure tells you the category. Maps perfectly to TypeScript discriminated unions."
    },
    {
      "question": "Include homebrew/custom string escape hatch?",
      "answer": "No",
      "reason": "Premature abstraction. Adding it now biases toward string-based solutions. Add when concrete use case exists."
    },
    {
      "question": "Separate FeatureId and ConditionId enums?",
      "answer": "ConditionId only for now",
      "reason": "Damage comes from active conditions (raging, brutal_critical), not passive features. Features activate conditions. Only add FeatureId when use case requires it."
    },
    {
      "question": "What conditions to include in ConditionId?",
      "answer": "Only ones with concrete use cases from toolkit's DamageSourceType",
      "reason": "YAGNI - raging, brutal_critical, fighting_style_dueling, fighting_style_two_weapon_fighting, sneak_attack, divine_smite"
    },
    {
      "question": "Where does SourceRef message live?",
      "answer": "common.proto",
      "reason": "Reusable pattern - damage sources, effect sources, etc. may all use similar structure"
    }
  ],
  "open_questions": [],
  "affected_projects": [
    {
      "project": "rpg-api-protos",
      "changes": [
        "ConditionId enum in enums.proto",
        "SourceRef message in common.proto with oneof",
        "DamageComponent.source changes from string to SourceRef"
      ],
      "design": "design-protos.md",
      "issue": "https://github.com/KirkDiggler/rpg-api-protos/issues/83"
    },
    {
      "project": "rpg-toolkit",
      "changes": [
        "Update DamageSourceType constants to map to ConditionId",
        "Conversion helpers for proto SourceRef"
      ],
      "design": null,
      "issue": null
    },
    {
      "project": "rpg-dnd5e-web",
      "changes": [
        "Enum display component for ConditionId",
        "DamageSourceBadge component using oneof pattern"
      ],
      "design": null,
      "issue": null
    }
  ]
}
